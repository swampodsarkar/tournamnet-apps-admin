<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CyberFire Admin Panel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #6e00ff;
  --secondary: #ff00f7;
  --accent: #00f0ff;
  --dark: #0f0f1a;
  --darker: #0a0a12;
  --card-bg: #1b1b2f;
  --card-border: #2a2a42;
  --text-light: #e0e0ff;
  --text-muted: #8a8aa8;
  --notification-bg: #2a2a42;
  --notification-success: #28a745;
  --notification-error: #dc3545;
  --notification-warning: #ffc107;
}

body {
  background: var(--dark);
  color: var(--text-light);
  font-family: 'Roboto', sans-serif;
  min-height: 100vh;
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
}

/* Login Modal */
#login-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.login-card {
  background: var(--card-bg);
  border: 1px solid var(--primary);
  border-radius: 12px;
  width: 100%;
  max-width: 400px;
  padding: 30px;
  box-shadow: 0 0 30px rgba(110, 0, 255, 0.3);
  animation: glow 2s infinite alternate;
}

@keyframes glow {
  from {
    box-shadow: 0 0 20px rgba(110, 0, 255, 0.3);
  }
  to {
    box-shadow: 0 0 30px rgba(110, 0, 255, 0.6);
  }
}

/* Main Content */
.container {
  max-width: 1400px;
  padding-top: 20px;
  padding-bottom: 40px;
}

/* Cards */
.card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  margin-bottom: 20px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
}

.card-header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border-bottom: 1px solid var(--card-border);
  padding: 15px 20px;
  font-family: 'Orbitron', sans-serif;
  font-weight: 500;
  letter-spacing: 1px;
}

/* Buttons */
.btn-brand {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 500;
  letter-spacing: 0.5px;
  transition: all 0.3s;
  padding: 8px 16px;
}

.btn-brand:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(110, 0, 255, 0.4);
  color: white;
}

.btn-outline-brand {
  color: var(--primary);
  border: 1px solid var(--primary);
  background: transparent;
}

.btn-outline-brand:hover {
  background: var(--primary);
  color: white;
}

.btn-accent {
  background: var(--accent);
  color: var(--dark);
  font-weight: 600;
}

.btn-accent:hover {
  background: #00d9e8;
  color: var(--dark);
}

/* Tables */
.table {
  color: var(--text-light);
  margin-bottom: 0;
}

.table thead th {
  color: var(--accent);
  border-bottom: 2px solid var(--primary);
  font-family: 'Orbitron', sans-serif;
  font-weight: 500;
  letter-spacing: 0.5px;
}

.table tbody tr {
  transition: all 0.2s;
}

.table tbody tr:hover {
  background: rgba(110, 0, 255, 0.1);
}

.table td, .table th {
  padding: 12px 15px;
  vertical-align: middle;
  border-top: 1px solid var(--card-border);
}

/* Status Badges */
.badge-pill {
  border-radius: 12px;
  padding: 5px 12px;
  font-weight: 500;
  font-size: 0.8rem;
}

.badge-pending {
  background: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

.badge-approved {
  background: rgba(40, 167, 69, 0.2);
  color: #28a745;
}

.badge-rejected {
  background: rgba(220, 53, 69, 0.2);
  color: #dc3545;
}

.badge-banned {
  background: rgba(220, 53, 69, 0.2);
  color: #dc3545;
}

.badge-verified {
  background: rgba(0, 240, 255, 0.2);
  color: var(--accent);
}

/* Icons */
.icon {
  margin-right: 8px;
}

.blue-tick {
  color: var(--accent);
}

/* Navbar */
.admin-navbar {
  background: var(--darker);
  border-bottom: 1px solid var(--primary);
  padding: 15px 0;
}

.admin-navbar .navbar-brand {
  font-family: 'Orbitron', sans-serif;
  font-weight: 700;
  color: white;
  font-size: 1.5rem;
  letter-spacing: 1px;
}

.admin-navbar .navbar-brand span {
  color: var(--accent);
}

.admin-navbar .nav-link {
  color: var(--text-light);
  font-family: 'Orbitron', sans-serif;
  font-weight: 500;
  margin: 0 10px;
  letter-spacing: 0.5px;
}

.admin-navbar .nav-link:hover {
  color: var(--accent);
}

.admin-navbar .nav-link.active {
  color: var(--accent);
  border-bottom: 2px solid var(--accent);
}

/* Stats Cards */
.stats-card {
  text-align: center;
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
}

.stats-card .stats-value {
  font-size: 2.5rem;
  font-weight: 700;
  font-family: 'Orbitron', sans-serif;
  margin: 10px 0;
  color: var(--accent);
}

.stats-card .stats-label {
  color: var(--text-muted);
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Notification System */
.notification-container {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 9999;
  max-width: 350px;
  width: 100%;
}

.notification {
  background: var(--notification-bg);
  border-left: 4px solid var(--primary);
  border-radius: 6px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  display: flex;
  align-items: center;
  transform: translateX(120%);
  transition: all 0.3s ease;
}

.notification.show {
  transform: translateX(0);
}

.notification.success {
  border-left-color: var(--notification-success);
}

.notification.error {
  border-left-color: var(--notification-error);
}

.notification.warning {
  border-left-color: var(--notification-warning);
}

.notification-icon {
  font-size: 1.5rem;
  margin-right: 15px;
}

.notification-content {
  flex: 1;
}

.notification-close {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 1.2rem;
  cursor: pointer;
  margin-left: 10px;
}

/* Global Notification Section */
.global-notification-card {
  margin-bottom: 30px;
}

.notification-form .form-control, 
.notification-form .form-select {
  background: var(--darker);
  border: 1px solid var(--card-border);
  color: var(--text-light);
}

.notification-form .form-control:focus, 
.notification-form .form-select:focus {
  background: var(--darker);
  color: var(--text-light);
  border-color: var(--primary);
  box-shadow: 0 0 0 0.25rem rgba(110, 0, 255, 0.25);
}

/* Tournament Modal */
.modal-content {
  background: var(--card-bg);
  border: 1px solid var(--primary);
  color: var(--text-light);
}

.modal-header {
  border-bottom: 1px solid var(--card-border);
}

.modal-footer {
  border-top: 1px solid var(--card-border);
}

.form-control, .form-select {
  background: var(--darker);
  border: 1px solid var(--card-border);
  color: var(--text-light);
}

.form-control:focus, .form-select:focus {
  background: var(--darker);
  color: var(--text-light);
  border-color: var(--primary);
  box-shadow: 0 0 0 0.25rem rgba(110, 0, 255, 0.25);
}

/* Responsive */
@media (max-width: 768px) {
  .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .admin-navbar .nav-link {
    margin: 5px 0;
    padding: 8px 15px;
  }
  
  .notification-container {
    top: 10px;
    right: 10px;
    max-width: calc(100% - 20px);
  }
}

/* Referral Badge */
.badge-referral {
  background: rgba(255, 193, 7, 0.2);
  color: #ffc107;
}

/* Custom Tabs */
.nav-tabs {
  border-bottom: 1px solid var(--card-border);
}

.nav-tabs .nav-link {
  color: var(--text-muted);
  border: 1px solid transparent;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
  font-family: 'Orbitron', sans-serif;
  font-weight: 500;
}

.nav-tabs .nav-link:hover {
  border-color: transparent;
  color: var(--accent);
}

.nav-tabs .nav-link.active {
  color: var(--accent);
  background: transparent;
  border-color: var(--card-border) var(--card-border) var(--card-bg);
}

.tab-content {
  padding: 20px 0;
}

/* Action Buttons */
.action-buttons .btn {
  margin-right: 5px;
  margin-bottom: 5px;
}
</style>
</head>
<body>

<!-- Notification Container -->
<div class="notification-container" id="notification-container"></div>

<!-- Login Modal -->
<div id="login-modal">
  <div class="login-card">
    <div class="text-center mb-4">
      <h2><i class="fas fa-shield-alt"></i> Admin Access</h2>
      <p class="text-muted">Enter password to continue</p>
    </div>
    <div class="mb-3">
      <input type="password" id="admin-password" class="form-control form-control-lg" placeholder="Enter Password" autocomplete="current-password">
      <div id="password-error" class="text-danger mt-2" style="display: none;">Incorrect password</div>
    </div>
    <button id="btn-login" class="btn btn-brand w-100">
      <i class="fas fa-sign-in-alt"></i> Login
    </button>
  </div>
</div>

<!-- Admin Navbar -->
<nav class="admin-navbar navbar navbar-expand-lg navbar-dark">
  <div class="container">
    <a class="navbar-brand" href="#">
      <i class="fas fa-fire"></i> Cyber<span>Fire</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#adminNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="adminNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link active" href="#users"><i class="fas fa-users"></i> Users</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#deposits"><i class="fas fa-money-bill-wave"></i> Deposits</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#withdrawals"><i class="fas fa-hand-holding-usd"></i> Withdrawals</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#tournaments"><i class="fas fa-trophy"></i> Tournaments</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#notifications"><i class="fas fa-bell"></i> Notifications</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" id="btn-logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container" id="admin-content" style="display: none;">
  <!-- Stats Row -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="stats-card card">
        <i class="fas fa-users fa-2x"></i>
        <div class="stats-value" id="total-users">0</div>
        <div class="stats-label">Total Users</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stats-card card">
        <i class="fas fa-money-bill-wave fa-2x"></i>
        <div class="stats-value" id="total-deposits">0</div>
        <div class="stats-label">Pending Deposits</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stats-card card">
        <i class="fas fa-hand-holding-usd fa-2x"></i>
        <div class="stats-value" id="total-withdrawals">0</div>
        <div class="stats-label">Pending Withdrawals</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stats-card card">
        <i class="fas fa-trophy fa-2x"></i>
        <div class="stats-value" id="total-tournaments">0</div>
        <div class="stats-label">Pending Tournaments</div>
      </div>
    </div>
  </div>

  <!-- USERS TABLE -->
  <div class="card" id="users-section">
    <div class="card-header">
      <h4 class="mb-0"><i class="fas fa-users icon"></i> All Users</h4>
    </div>
    <div class="card-body">
      <ul class="nav nav-tabs" id="usersTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="players-tab" data-bs-toggle="tab" data-bs-target="#players" type="button" role="tab">Players</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="organizers-tab" data-bs-toggle="tab" data-bs-target="#organizers" type="button" role="tab">Organizers</button>
        </li>
      </ul>
      <div class="tab-content" id="usersTabContent">
        <div class="tab-pane fade show active" id="players" role="tabpanel">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Referrals</th>
                  <th>Wallet</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="players-body"></tbody>
            </table>
          </div>
        </div>
        <div class="tab-pane fade" id="organizers" role="tabpanel">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Referrals</th>
                  <th>Wallet</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="organizers-body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ADD BALANCE REQUESTS -->
  <div class="card mt-4" id="deposits-section">
    <div class="card-header">
      <h4 class="mb-0"><i class="fas fa-money-bill-wave icon"></i> Player Deposit Requests</h4>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Player</th>
              <th>Amount</th>
              <th>Number</th>
              <th>Method</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="balance-req-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- WITHDRAW REQUESTS -->
  <div class="card mt-4" id="withdrawals-section">
    <div class="card-header">
      <h4 class="mb-0"><i class="fas fa-hand-holding-usd icon"></i> Organizer Withdraw Requests</h4>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Organizer</th>
              <th>Amount</th>
              <th>Number</th>
              <th>Method</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="withdraw-req-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- TOURNAMENTS -->
  <div class="card mt-4" id="tournaments-section">
    <div class="card-header">
      <h4 class="mb-0"><i class="fas fa-trophy icon"></i> All Tournaments</h4>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Organizer</th>
              <th>Fee</th>
              <th>Prize</th>
              <th>Date & Time</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tournaments-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- GLOBAL NOTIFICATIONS -->
  <div class="card mt-4" id="notifications-section">
    <div class="card-header">
      <h4 class="mb-0"><i class="fas fa-bell icon"></i> Global Notifications</h4>
    </div>
    <div class="card-body">
      <div class="global-notification-card">
        <h5><i class="fas fa-bullhorn me-2"></i>Send Notification to All Users</h5>
        <form id="notification-form" class="notification-form">
          <div class="mb-3">
            <label for="notification-title" class="form-label">Title</label>
            <input type="text" class="form-control" id="notification-title" placeholder="Enter notification title" required>
          </div>
          <div class="mb-3">
            <label for="notification-message" class="form-label">Message</label>
            <textarea class="form-control" id="notification-message" rows="3" placeholder="Enter notification message" required></textarea>
          </div>
          <div class="mb-3">
            <label for="notification-type" class="form-label">Notification Type</label>
            <select class="form-select" id="notification-type" required>
              <option value="info">Information</option>
              <option value="warning">Warning</option>
              <option value="important">Important</option>
            </select>
          </div>
          <button type="submit" class="btn btn-brand">
            <i class="fas fa-paper-plane me-2"></i> Send Notification
          </button>
        </form>
      </div>
      
      <div class="mt-4">
        <h5><i class="fas fa-history me-2"></i>Recent Notifications</h5>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Title</th>
                <th>Message</th>
                <th>Type</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="notifications-body"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tournament Edit Modal -->
<div class="modal fade" id="editTournamentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Tournament</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="edit-tournament-form">
          <input type="hidden" id="edit-tournament-id">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="edit-tournament-name" class="form-label">Tournament Name</label>
              <input type="text" class="form-control" id="edit-tournament-name" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="edit-tournament-fee" class="form-label">Entry Fee</label>
              <input type="number" class="form-control" id="edit-tournament-fee" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="edit-tournament-prize" class="form-label">Prize Pool</label>
              <input type="text" class="form-control" id="edit-tournament-prize" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="edit-tournament-status" class="form-label">Status</label>
              <select class="form-select" id="edit-tournament-status" required>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
                <option value="completed">Completed</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="edit-tournament-date" class="form-label">Date</label>
              <input type="date" class="form-control" id="edit-tournament-date" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="edit-tournament-time" class="form-label">Time</label>
              <input type="time" class="form-control" id="edit-tournament-time" required>
            </div>
          </div>
          <div class="mb-3">
            <label for="edit-tournament-desc" class="form-label">Description</label>
            <textarea class="form-control" id="edit-tournament-desc" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label for="edit-tournament-rules" class="form-label">Rules</label>
            <textarea class="form-control" id="edit-tournament-rules" rows="3" required></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-brand" id="btn-update-tournament">Update Tournament</button>
      </div>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD1-qeqgWg9-3TW--XnpWQHNTP7-ROhDIs",
  authDomain: "football-manager-cf301.firebaseapp.com",
  databaseURL: "https://football-manager-cf301-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "football-manager-cf301",
  storageBucket: "football-manager-cf301.firebasestorage.app",
  messagingSenderId: "491848692016",
  appId: "1:491848692016:web:dc080692f1c5ee6c5298f5",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Password protection
const ADMIN_PASSWORD = "swampod321";
let isAuthenticated = false;

// UI Elements
const loginModal = document.getElementById('login-modal');
const adminPassword = document.getElementById('admin-password');
const btnLogin = document.getElementById('btn-login');
const passwordError = document.getElementById('password-error');
const adminContent = document.getElementById('admin-content');
const btnLogout = document.getElementById('btn-logout');
const notificationForm = document.getElementById('notification-form');
const notificationContainer = document.getElementById('notification-container');
const editTournamentModal = new bootstrap.Modal(document.getElementById('editTournamentModal'));
const btnUpdateTournament = document.getElementById('btn-update-tournament');

// Login function
btnLogin.addEventListener('click', () => {
  if (adminPassword.value === ADMIN_PASSWORD) {
    isAuthenticated = true;
    loginModal.style.display = 'none';
    adminContent.style.display = 'block';
    loadAllData();
    showNotification('Login successful', 'Welcome to CyberFire Admin Panel', 'success');
  } else {
    passwordError.style.display = 'block';
    adminPassword.classList.add('is-invalid');
    showNotification('Login failed', 'Incorrect password', 'error');
  }
});

// Logout function
btnLogout.addEventListener('click', () => {
  isAuthenticated = false;
  adminContent.style.display = 'none';
  loginModal.style.display = 'flex';
  adminPassword.value = '';
  passwordError.style.display = 'none';
  adminPassword.classList.remove('is-invalid');
  showNotification('Logged out', 'You have been logged out successfully', 'info');
});

// Notification system
function showNotification(title, message, type = 'info') {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <div class="notification-icon">
      ${type === 'success' ? '<i class="fas fa-check-circle"></i>' : 
        type === 'error' ? '<i class="fas fa-exclamation-circle"></i>' : 
        '<i class="fas fa-info-circle"></i>'}
    </div>
    <div class="notification-content">
      <h6 class="mb-1">${title}</h6>
      <p class="small mb-0">${message}</p>
    </div>
    <button class="notification-close">
      <i class="fas fa-times"></i>
    </button>
  `;
  
  notificationContainer.appendChild(notification);
  
  // Show notification
  setTimeout(() => {
    notification.classList.add('show');
  }, 100);
  
  // Close button event
  notification.querySelector('.notification-close').addEventListener('click', () => {
    notification.classList.remove('show');
    setTimeout(() => {
      notification.remove();
    }, 300);
  });
  
  // Auto remove after 5 seconds
  setTimeout(() => {
    notification.classList.remove('show');
    setTimeout(() => {
      notification.remove();
    }, 300);
  }, 5000);
}

// Send global notification
notificationForm.addEventListener('submit', (e) => {
  e.preventDefault();
  
  const title = document.getElementById('notification-title').value;
  const message = document.getElementById('notification-message').value;
  const type = document.getElementById('notification-type').value;
  
  if (!title || !message) {
    showNotification('Error', 'Please fill all fields', 'error');
    return;
  }
  
  const notificationId = Date.now();
  const notificationData = {
    title,
    message,
    type,
    timestamp: firebase.database.ServerValue.TIMESTAMP,
    read: false
  };
  
  // Save to database
  db.ref(`notifications/${notificationId}`).set(notificationData)
    .then(() => {
      showNotification('Success', 'Notification sent to all users', 'success');
      notificationForm.reset();
      loadNotifications();
    })
    .catch(error => {
      showNotification('Error', 'Failed to send notification: ' + error.message, 'error');
    });
});

// Load all data
function loadAllData() {
  loadPlayers();
  loadOrganizers();
  loadBalanceRequests();
  loadWithdrawRequests();
  loadTournaments();
  loadStats();
  loadNotifications();
}

// Stats counter
function loadStats() {
  // Total users
  db.ref('users').on('value', snap => {
    const users = snap.val() || {};
    document.getElementById('total-users').textContent = Object.keys(users).length;
  });

  // Pending deposits
  db.ref('paymentRequests').orderByChild('type').equalTo('deposit').on('value', snap => {
    const requests = snap.val() || {};
    let pendingCount = 0;
    Object.values(requests).forEach(req => {
      if (req.status === 'pending') pendingCount++;
    });
    document.getElementById('total-deposits').textContent = pendingCount;
  });

  // Pending withdrawals
  db.ref('paymentRequests').orderByChild('type').equalTo('withdraw').on('value', snap => {
    const requests = snap.val() || {};
    let pendingCount = 0;
    Object.values(requests).forEach(req => {
      if (req.status === 'pending') pendingCount++;
    });
    document.getElementById('total-withdrawals').textContent = pendingCount;
  });

  // Pending tournaments
  db.ref('tournaments').orderByChild('status').equalTo('pending').on('value', snap => {
    const tournaments = snap.val() || {};
    document.getElementById('total-tournaments').textContent = Object.keys(tournaments).length;
  });
}

// PLAYERS LIST
function loadPlayers() {
  db.ref('users').orderByChild('role').equalTo('player').on('value', snap => {
    const players = snap.val() || {};
    const body = document.getElementById('players-body');
    body.innerHTML = '';
    
    Object.entries(players).forEach(([uid, player]) => {
      const tr = document.createElement('tr');
      
      // Get user status badge
      let statusBadge = '';
      if (player.ban) {
        statusBadge = '<span class="badge badge-pill badge-banned">Banned</span>';
      } else {
        statusBadge = '<span class="badge badge-pill" style="background: rgba(255,255,255,0.1);">Active</span>';
      }
      
      tr.innerHTML = `
        <td>${player.name}</td>
        <td>${player.email}</td>
        <td>
          <span class="badge badge-pill badge-referral">
            ${player.referralCount || 0} Referrals
          </span>
        </td>
        <td>৳${player.wallet || 0}</td>
        <td>${statusBadge}</td>
        <td class="action-buttons">
          <button class="btn btn-sm btn-brand ban-btn" data-uid="${uid}" data-ban="${player.ban || false}">
            ${player.ban ? '<i class="fas fa-unlock me-1"></i> Unban' : '<i class="fas fa-ban me-1"></i> Ban'}
          </button>
          <button class="btn btn-sm btn-accent ms-1 add-balance-btn" data-uid="${uid}">
            <i class="fas fa-plus me-1"></i> Add Balance
          </button>
        </td>
      `;
      
      body.appendChild(tr);
      
      // Add ban/unban event
      tr.querySelector('.ban-btn').addEventListener('click', function() {
        const isBanned = this.getAttribute('data-ban') === 'true';
        const action = isBanned ? 'unbanned' : 'banned';
        
        db.ref(`users/${uid}/ban`).set(!isBanned)
          .then(() => {
            const notificationTitle = isBanned ? 'Player Unbanned' : 'Player Banned';
            const notificationMessage = `${player.name} has been ${action} by admin`;
            const notificationType = isBanned ? 'success' : 'warning';
            
            showNotification(notificationTitle, notificationMessage, notificationType);
            
            // Send notification to the player
            if (!isBanned) {
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${uid}/${userNotificationId}`).set({
                title: 'Account Status Update',
                message: 'Your account has been banned by admin. Please contact support for more information.',
                type: 'important',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            }
          })
          .catch(error => {
            showNotification('Error', `Failed to ${action} player: ${error.message}`, 'error');
          });
      });
      
      // Add balance button
      tr.querySelector('.add-balance-btn').addEventListener('click', function() {
        const amount = prompt(`Enter amount to add to ${player.name}'s wallet:`);
        if (amount && !isNaN(amount) && parseFloat(amount) > 0) {
          const amountNum = parseFloat(amount);
          db.ref(`users/${uid}/wallet`).transaction(current => (current || 0) + amountNum)
            .then(() => {
              showNotification('Balance Added', `৳${amountNum} added to ${player.name}'s wallet`, 'success');
              
              // Send notification to player
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${uid}/${userNotificationId}`).set({
                title: 'Balance Added',
                message: `Admin has added ৳${amountNum} to your wallet.`,
                type: 'success',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            })
            .catch(error => {
              showNotification('Error', `Failed to add balance: ${error.message}`, 'error');
            });
        } else if (amount !== null) {
          showNotification('Error', 'Please enter a valid amount', 'error');
        }
      });
    });
  });
}

// ORGANIZERS LIST
function loadOrganizers() {
  db.ref('users').orderByChild('role').equalTo('organizer').on('value', snap => {
    const organizers = snap.val() || {};
    const body = document.getElementById('organizers-body');
    body.innerHTML = '';
    
    Object.entries(organizers).forEach(([uid, organizer]) => {
      const tr = document.createElement('tr');
      
      // Get user status badge
      let statusBadge = '';
      if (organizer.ban) {
        statusBadge = '<span class="badge badge-pill badge-banned">Banned</span>';
      } else if (organizer.verified) {
        statusBadge = '<span class="badge badge-pill badge-verified">Verified</span>';
      } else {
        statusBadge = '<span class="badge badge-pill" style="background: rgba(255,255,255,0.1);">Active</span>';
      }
      
      tr.innerHTML = `
        <td>
          ${organizer.name}
          ${organizer.verified ? '<i class="fas fa-check-circle blue-tick ms-1"></i>' : ''}
        </td>
        <td>${organizer.email}</td>
        <td>
          <span class="badge badge-pill badge-referral">
            ${organizer.referralCount || 0} Referrals
          </span>
        </td>
        <td>৳${organizer.wallet || 0}</td>
        <td>${statusBadge}</td>
        <td class="action-buttons">
          <button class="btn btn-sm btn-brand ban-btn" data-uid="${uid}" data-ban="${organizer.ban || false}">
            ${organizer.ban ? '<i class="fas fa-unlock me-1"></i> Unban' : '<i class="fas fa-ban me-1"></i> Ban'}
          </button>
          <button class="btn btn-sm btn-accent verify-btn" data-uid="${uid}" data-verified="${organizer.verified || false}">
            ${organizer.verified ? '<i class="fas fa-times me-1"></i> Unverify' : '<i class="fas fa-check me-1"></i> Verify'}
          </button>
        </td>
      `;
      
      body.appendChild(tr);
      
      // Add ban/unban event
      tr.querySelector('.ban-btn').addEventListener('click', function() {
        const isBanned = this.getAttribute('data-ban') === 'true';
        const action = isBanned ? 'unbanned' : 'banned';
        
        db.ref(`users/${uid}/ban`).set(!isBanned)
          .then(() => {
            const notificationTitle = isBanned ? 'Organizer Unbanned' : 'Organizer Banned';
            const notificationMessage = `${organizer.name} has been ${action} by admin`;
            const notificationType = isBanned ? 'success' : 'warning';
            
            showNotification(notificationTitle, notificationMessage, notificationType);
            
            // Send notification to the organizer
            if (!isBanned) {
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${uid}/${userNotificationId}`).set({
                title: 'Account Status Update',
                message: 'Your account has been banned by admin. Please contact support for more information.',
                type: 'important',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            }
          })
          .catch(error => {
            showNotification('Error', `Failed to ${action} organizer: ${error.message}`, 'error');
          });
      });
      
      // Add verify/unverify event
      tr.querySelector('.verify-btn').addEventListener('click', function() {
        const isVerified = this.getAttribute('data-verified') === 'true';
        const action = isVerified ? 'unverified' : 'verified';
        
        db.ref(`users/${uid}/verified`).set(!isVerified)
          .then(() => {
            const notificationTitle = isVerified ? 'Organizer Unverified' : 'Organizer Verified';
            const notificationMessage = `${organizer.name} has been ${action} by admin`;
            
            showNotification(notificationTitle, notificationMessage, 'success');
            
            // Send notification to the organizer
            const userNotificationId = Date.now();
            db.ref(`userNotifications/${uid}/${userNotificationId}`).set({
              title: 'Verification Status Update',
              message: `Your organizer account has been ${action} by admin.`,
              type: 'info',
              timestamp: firebase.database.ServerValue.TIMESTAMP,
              read: false
            });
          })
          .catch(error => {
            showNotification('Error', `Failed to ${action} organizer: ${error.message}`, 'error');
          });
      });
    });
  });
}

// BALANCE REQUESTS (Deposits)
function loadBalanceRequests() {
  db.ref('paymentRequests').orderByChild('type').equalTo('deposit').on('value', snap => {
    const requests = snap.val() || {};
    const body = document.getElementById('balance-req-body');
    body.innerHTML = '';
    
    Object.entries(requests).forEach(([rid, request]) => {
      const tr = document.createElement('tr');
      
      // Get status badge
      let statusBadge = '';
      if (request.status === 'pending') {
        statusBadge = '<span class="badge badge-pill badge-pending">Pending</span>';
      } else if (request.status === 'approved') {
        statusBadge = '<span class="badge badge-pill badge-approved">Approved</span>';
      } else {
        statusBadge = '<span class="badge badge-pill badge-rejected">Rejected</span>';
      }
      
      // Format date
      const requestDate = new Date(request.timestamp);
      const formattedDate = requestDate.toLocaleDateString() + ' ' + requestDate.toLocaleTimeString();
      
      tr.innerHTML = `
        <td>${request.userName || 'N/A'}</td>
        <td>৳${request.amount}</td>
        <td>${request.number}</td>
        <td>${request.method ? request.method.toUpperCase() : 'N/A'}</td>
        <td>${statusBadge}</td>
        <td>${formattedDate}</td>
        <td class="action-buttons">
          ${request.status === 'pending' ? `
            <button class="btn btn-sm btn-success approve-btn me-1" data-rid="${rid}" data-uid="${request.userId}" data-amount="${request.amount}">
              <i class="fas fa-check me-1"></i> Approve
            </button>
            <button class="btn btn-sm btn-danger reject-btn" data-rid="${rid}">
              <i class="fas fa-times me-1"></i> Reject
            </button>
          ` : 'No actions'}
        </td>
      `;
      
      body.appendChild(tr);
      
      // Add approve/reject events if pending
      if (request.status === 'pending') {
        tr.querySelector('.approve-btn').addEventListener('click', async function() {
          const requestId = this.getAttribute('data-rid');
          const userId = this.getAttribute('data-uid');
          const amount = parseInt(this.getAttribute('data-amount'));
          
          try {
            // Update request status
            await db.ref(`paymentRequests/${requestId}/status`).set('approved');
            
            // Update user wallet
            await db.ref(`users/${userId}/wallet`).transaction(current => (current || 0) + amount);
            
            showNotification('Deposit Approved', `৳${amount} added to user's wallet`, 'success');
            
            // Send notification to user
            const userNotificationId = Date.now();
            db.ref(`userNotifications/${userId}/${userNotificationId}`).set({
              title: 'Deposit Approved',
              message: `Your deposit of ৳${amount} has been approved and added to your wallet.`,
              type: 'success',
              timestamp: firebase.database.ServerValue.TIMESTAMP,
              read: false
            });
          } catch (error) {
            showNotification('Error', 'Failed to approve deposit: ' + error.message, 'error');
          }
        });
        
        tr.querySelector('.reject-btn').addEventListener('click', function() {
          const requestId = this.getAttribute('data-rid');
          const userId = this.getAttribute('data-uid');
          const amount = parseInt(this.getAttribute('data-amount'));
          
          db.ref(`paymentRequests/${requestId}/status`).set('rejected')
            .then(() => {
              showNotification('Deposit Rejected', 'Deposit request has been rejected', 'warning');
              
              // Send notification to user
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${userId}/${userNotificationId}`).set({
                title: 'Deposit Rejected',
                message: `Your deposit request of ৳${amount} has been rejected by admin.`,
                type: 'warning',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            })
            .catch(error => {
              showNotification('Error', 'Failed to reject deposit: ' + error.message, 'error');
            });
        });
      }
    });
  });
}

// WITHDRAW REQUESTS
function loadWithdrawRequests() {
  db.ref('paymentRequests').orderByChild('type').equalTo('withdraw').on('value', snap => {
    const requests = snap.val() || {};
    const body = document.getElementById('withdraw-req-body');
    body.innerHTML = '';
    
    Object.entries(requests).forEach(([rid, request]) => {
      const tr = document.createElement('tr');
      
      // Get status badge
      let statusBadge = '';
      if (request.status === 'pending') {
        statusBadge = '<span class="badge badge-pill badge-pending">Pending</span>';
      } else if (request.status === 'approved') {
        statusBadge = '<span class="badge badge-pill badge-approved">Approved</span>';
      } else {
        statusBadge = '<span class="badge badge-pill badge-rejected">Rejected</span>';
      }
      
      // Format date
      const requestDate = new Date(request.timestamp);
      const formattedDate = requestDate.toLocaleDateString() + ' ' + requestDate.toLocaleTimeString();
      
      tr.innerHTML = `
        <td>${request.userName || 'N/A'}</td>
        <td>৳${request.amount}</td>
        <td>${request.number}</td>
        <td>${request.method ? request.method.toUpperCase() : 'N/A'}</td>
        <td>${statusBadge}</td>
        <td>${formattedDate}</td>
        <td class="action-buttons">
          ${request.status === 'pending' ? `
            <button class="btn btn-sm btn-success approve-btn me-1" data-rid="${rid}" data-uid="${request.userId}" data-amount="${request.amount}">
              <i class="fas fa-check me-1"></i> Approve
            </button>
            <button class="btn btn-sm btn-danger reject-btn" data-rid="${rid}">
              <i class="fas fa-times me-1"></i> Reject
            </button>
          ` : 'No actions'}
        </td>
      `;
      
      body.appendChild(tr);
      
      // Add approve/reject events if pending
      if (request.status === 'pending') {
        tr.querySelector('.approve-btn').addEventListener('click', async function() {
          const requestId = this.getAttribute('data-rid');
          const userId = this.getAttribute('data-uid');
          const amount = parseInt(this.getAttribute('data-amount'));
          
          try {
            // Update request status
            await db.ref(`paymentRequests/${requestId}/status`).set('approved');
            
            // Update user wallet (deduct amount)
            await db.ref(`users/${userId}/wallet`).transaction(current => (current || 0) - amount);
            
            showNotification('Withdrawal Approved', `৳${amount} withdrawn from user's wallet`, 'success');
            
            // Send notification to user
            const userNotificationId = Date.now();
            db.ref(`userNotifications/${userId}/${userNotificationId}`).set({
              title: 'Withdrawal Approved',
              message: `Your withdrawal request of ৳${amount} has been approved. The amount will be sent to your payment method shortly.`,
              type: 'success',
              timestamp: firebase.database.ServerValue.TIMESTAMP,
              read: false
            });
          } catch (error) {
            showNotification('Error', 'Failed to approve withdrawal: ' + error.message, 'error');
          }
        });
        
        tr.querySelector('.reject-btn').addEventListener('click', function() {
          const requestId = this.getAttribute('data-rid');
          const userId = this.getAttribute('data-uid');
          const amount = parseInt(this.getAttribute('data-amount'));
          
          db.ref(`paymentRequests/${requestId}/status`).set('rejected')
            .then(() => {
              showNotification('Withdrawal Rejected', 'Withdrawal request has been rejected', 'warning');
              
              // Send notification to user
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${userId}/${userNotificationId}`).set({
                title: 'Withdrawal Rejected',
                message: `Your withdrawal request of ৳${amount} has been rejected by admin.`,
                type: 'warning',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            })
            .catch(error => {
              showNotification('Error', 'Failed to reject withdrawal: ' + error.message, 'error');
            });
        });
      }
    });
  });
}

// TOURNAMENTS
function loadTournaments() {
  db.ref('tournaments').on('value', snap => {
    const tournaments = snap.val() || {};
    const body = document.getElementById('tournaments-body');
    body.innerHTML = '';
    
    Object.entries(tournaments).forEach(([tid, tournament]) => {
      const tr = document.createElement('tr');
      
      // Get status badge
      let statusBadge = '';
      if (tournament.status === 'pending') {
        statusBadge = '<span class="badge badge-pill badge-pending">Pending</span>';
      } else if (tournament.status === 'approved') {
        statusBadge = '<span class="badge badge-pill badge-approved">Approved</span>';
      } else if (tournament.status === 'completed') {
        statusBadge = '<span class="badge badge-pill" style="background: rgba(0, 123, 255, 0.2); color: #007bff;">Completed</span>';
      } else {
        statusBadge = '<span class="badge badge-pill badge-rejected">Rejected</span>';
      }
      
      // Format date and time
      const tournamentDate = new Date(tournament.date);
      const formattedDate = tournamentDate.toLocaleDateString() + ' ' + (tournament.time || '');
      
      tr.innerHTML = `
        <td>${tournament.name}</td>
        <td>${tournament.organizerName || 'N/A'}</td>
        <td>৳${tournament.fee || 0}</td>
        <td>৳${tournament.prize || 'N/A'}</td>
        <td>${formattedDate}</td>
        <td>${statusBadge}</td>
        <td class="action-buttons">
          <button class="btn btn-sm btn-brand edit-btn" data-tid="${tid}">
            <i class="fas fa-edit me-1"></i> Edit
          </button>
          <button class="btn btn-sm btn-danger delete-btn" data-tid="${tid}" data-name="${tournament.name}">
            <i class="fas fa-trash me-1"></i> Delete
          </button>
          ${tournament.status === 'pending' ? `
            <button class="btn btn-sm btn-success approve-btn me-1" data-tid="${tid}" data-organizer="${tournament.organizer}">
              <i class="fas fa-check me-1"></i> Approve
            </button>
            <button class="btn btn-sm btn-danger reject-btn" data-tid="${tid}" data-organizer="${tournament.organizer}">
              <i class="fas fa-times me-1"></i> Reject
            </button>
          ` : ''}
        </td>
      `;
      
      body.appendChild(tr);
      
      // Edit tournament button
      tr.querySelector('.edit-btn').addEventListener('click', function() {
        const tournamentId = this.getAttribute('data-tid');
        const tournamentData = tournaments[tournamentId];
        
        // Fill the edit form
        document.getElementById('edit-tournament-id').value = tournamentId;
        document.getElementById('edit-tournament-name').value = tournamentData.name;
        document.getElementById('edit-tournament-fee').value = tournamentData.fee;
        document.getElementById('edit-tournament-prize').value = tournamentData.prize || '';
        document.getElementById('edit-tournament-status').value = tournamentData.status;
        
        // Format date for input
        const tournamentDate = new Date(tournamentData.date);
        const formattedDate = tournamentDate.toISOString().split('T')[0];
        document.getElementById('edit-tournament-date').value = formattedDate;
        
        document.getElementById('edit-tournament-time').value = tournamentData.time || '';
        document.getElementById('edit-tournament-desc').value = tournamentData.description || '';
        document.getElementById('edit-tournament-rules').value = tournamentData.rules || '';
        
        // Show modal
        editTournamentModal.show();
      });
      
      // Delete tournament button
      tr.querySelector('.delete-btn').addEventListener('click', function() {
        const tournamentId = this.getAttribute('data-tid');
        const tournamentName = this.getAttribute('data-name');
        
        if (confirm(`Are you sure you want to delete the tournament "${tournamentName}"?`)) {
          db.ref(`tournaments/${tournamentId}`).remove()
            .then(() => {
              showNotification('Tournament Deleted', `"${tournamentName}" has been deleted`, 'success');
            })
            .catch(error => {
              showNotification('Error', 'Failed to delete tournament: ' + error.message, 'error');
            });
        }
      });
      
      // Add approve/reject events if pending
      if (tournament.status === 'pending') {
        tr.querySelector('.approve-btn').addEventListener('click', function() {
          const tournamentId = this.getAttribute('data-tid');
          const organizerId = this.getAttribute('data-organizer');
          
          db.ref(`tournaments/${tournamentId}/status`).set('approved')
            .then(() => {
              showNotification('Tournament Approved', 'Tournament has been approved and published', 'success');
              
              // Send notification to organizer
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${organizerId}/${userNotificationId}`).set({
                title: 'Tournament Approved',
                message: `Your tournament "${tournament.name}" has been approved by admin and is now live.`,
                type: 'success',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            })
            .catch(error => {
              showNotification('Error', 'Failed to approve tournament: ' + error.message, 'error');
            });
        });
        
        tr.querySelector('.reject-btn').addEventListener('click', function() {
          const tournamentId = this.getAttribute('data-tid');
          const organizerId = this.getAttribute('data-organizer');
          
          db.ref(`tournaments/${tournamentId}/status`).set('rejected')
            .then(() => {
              showNotification('Tournament Rejected', 'Tournament has been rejected', 'warning');
              
              // Send notification to organizer
              const userNotificationId = Date.now();
              db.ref(`userNotifications/${organizerId}/${userNotificationId}`).set({
                title: 'Tournament Rejected',
                message: `Your tournament "${tournament.name}" has been rejected by admin.`,
                type: 'warning',
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                read: false
              });
            })
            .catch(error => {
              showNotification('Error', 'Failed to reject tournament: ' + error.message, 'error');
            });
        });
      }
    });
  });
}

// Update tournament
btnUpdateTournament.addEventListener('click', function() {
  const tournamentId = document.getElementById('edit-tournament-id').value;
  const tournamentData = {
    name: document.getElementById('edit-tournament-name').value,
    fee: document.getElementById('edit-tournament-fee').value,
    prize: document.getElementById('edit-tournament-prize').value,
    status: document.getElementById('edit-tournament-status').value,
    date: document.getElementById('edit-tournament-date').value,
    time: document.getElementById('edit-tournament-time').value,
    description: document.getElementById('edit-tournament-desc').value,
    rules: document.getElementById('edit-tournament-rules').value
  };
  
  if (!tournamentData.name || !tournamentData.fee || !tournamentData.date) {
    showNotification('Error', 'Please fill all required fields', 'error');
    return;
  }
  
  db.ref(`tournaments/${tournamentId}`).update(tournamentData)
    .then(() => {
      showNotification('Tournament Updated', 'Tournament details have been updated', 'success');
      editTournamentModal.hide();
    })
    .catch(error => {
      showNotification('Error', 'Failed to update tournament: ' + error.message, 'error');
    });
});

// LOAD NOTIFICATIONS
function loadNotifications() {
  db.ref('notifications').orderByChild('timestamp').limitToLast(10).on('value', snap => {
    const notifications = snap.val() || {};
    const body = document.getElementById('notifications-body');
    body.innerHTML = '';
    
    Object.entries(notifications).reverse().forEach(([nid, notification]) => {
      const tr = document.createElement('tr');
      
      // Format date
      const notificationDate = new Date(notification.timestamp);
      const formattedDate = notificationDate.toLocaleDateString() + ' ' + notificationDate.toLocaleTimeString();
      
      tr.innerHTML = `
        <td>${notification.title}</td>
        <td>${notification.message}</td>
        <td>
          <span class="badge ${notification.type === 'important' ? 'bg-danger' : 
                              notification.type === 'warning' ? 'bg-warning text-dark' : 'bg-info'}">
            ${notification.type}
          </span>
        </td>
        <td>${formattedDate}</td>
        <td>
          <button class="btn btn-sm btn-danger delete-notification-btn" data-nid="${nid}">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      `;
      
      body.appendChild(tr);
      
      // Delete notification button
      tr.querySelector('.delete-notification-btn').addEventListener('click', function() {
        const notificationId = this.getAttribute('data-nid');
        
        if (confirm('Are you sure you want to delete this notification?')) {
          db.ref(`notifications/${notificationId}`).remove()
            .then(() => {
              showNotification('Notification Deleted', 'The notification has been removed', 'success');
            })
            .catch(error => {
              showNotification('Error', 'Failed to delete notification: ' + error.message, 'error');
            });
        }
      });
    });
  });
}

// Smooth scrolling for navigation
document.querySelectorAll('.nav-link').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    const targetId = this.getAttribute('href').substring(1);
    document.getElementById(targetId + '-section').scrollIntoView({
      behavior: 'smooth'
    });
    
    // Update active nav link
    document.querySelectorAll('.nav-link').forEach(navLink => {
      navLink.classList.remove('active');
    });
    this.classList.add('active');
  });
});

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  // Check if already authenticated (for page refresh)
  if (isAuthenticated) {
    loginModal.style.display = 'none';
    adminContent.style.display = 'block';
    loadAllData();
  }
});
</script>
</body>
</html>
