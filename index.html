<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>FF Kingdom - Admin Panel</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #facc15;
  --primary-dark: #e6b800;
  --dark: #0f172a;
  --dark-light: #1e293b;
  --text: #f8fafc;
  --text-secondary: #cbd5e1;
  --success: #22c55e;
  --danger: #ef4444;
  --info: #3b82f6;
  --warning: #f59e0b;
  --royal: #a855f7;
  --organizer: #10b981;
  --admin: #ec4899;
}

body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: var(--dark);
  color: var(--text);
  padding-bottom: 60px;
}

.header {
  background: var(--dark-light);
  color: var(--primary);
  padding: 15px;
  text-align: center;
  font-weight: 700;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 100;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.header h1 {
  margin: 0;
  font-size: 1.5rem;
}

.search-container {
  position: relative;
  width: 100%;
  margin: 10px 0;
}

.search-input {
  width: 100%;
  padding: 12px 40px 12px 12px;
  border-radius: 25px;
  border: 1px solid #334155;
  background: var(--dark);
  color: var(--text);
  font-family: 'Poppins', sans-serif;
}

.search-icon {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-secondary);
}

.container {
  padding: 16px;
}

.card {
  background: var(--dark-light);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 16px;
  overflow: hidden;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  border: none;
}

.input-group {
  margin-bottom: 12px;
}

.input-group label {
  display: block;
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 5px;
}

.input-group input, .input-group select, .input-group textarea {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #334155;
  background: var(--dark);
  color: var(--text);
  font-family: 'Poppins', sans-serif;
}

.btn {
  background: var(--primary);
  color: var(--dark);
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.btn i {
  margin-right: 5px;
}

.btn:hover {
  opacity: 0.9;
  transform: translateY(-2px);
}

.btn-sm {
  padding: 6px 12px;
  font-size: 14px;
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-info {
  background: var(--info);
  color: white;
}

.btn-warning {
  background: var(--warning);
  color: white;
}

.btn-royal {
  background: var(--royal);
  color: white;
}

.btn-organizer {
  background: var(--organizer);
  color: white;
}

.btn-admin {
  background: var(--admin);
  color: white;
}

.hidden {
  display: none;
}

.nav-bottom {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  background: var(--dark-light);
  padding: 10px 0;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  z-index: 100;
}

.nav-btn {
  flex: 1;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 8px 0;
}

.nav-btn i {
  font-size: 18px;
  margin-bottom: 4px;
}

.nav-btn.active {
  color: var(--primary);
}

.countdown {
  color: var(--primary);
  font-weight: 700;
}

.tournament-card {
  transition: transform 0.3s;
  margin-bottom: 20px;
  overflow: hidden;
  position: relative;
}

.tournament-card:hover {
  transform: translateY(-5px);
}

.tournament-img {
  width: 100%;
  height: 160px;
  object-fit: cover;
  border-radius: 8px;
}

.tournament-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background: var(--primary);
  color: var(--dark);
  padding: 4px 8px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.tournament-content {
  padding: 12px;
}

.tournament-title {
  color: var(--primary);
  margin: 4px 0;
  font-size: 18px;
  font-weight: 600;
}

.tournament-info {
  font-size: 14px;
  color: var(--text-secondary);
  margin: 2px 0;
  display: flex;
  align-items: center;
  gap: 5px;
}

.tournament-actions {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.tournament-actions button {
  flex: 1;
}

.game-mode-badges {
  display: flex;
  gap: 5px;
  margin: 8px 0;
  flex-wrap: wrap;
}

.game-mode-badge {
  background: rgba(168, 85, 247, 0.2);
  color: var(--royal);
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
}

.profile-header {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
}

.profile-pic {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--primary);
}

.profile-info {
  margin-left: 15px;
}

.profile-name {
  font-size: 20px;
  font-weight: 600;
  margin: 0;
}

.profile-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  margin: 15px 0;
}

.stat-card {
  background: var(--dark);
  padding: 12px;
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--primary);
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary);
}

.emoji-picker {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  margin: 10px 0;
  max-height: 100px;
  overflow-y: auto;
  padding: 5px;
  background: var(--dark);
  border-radius: 8px;
}

.emoji-option {
  font-size: 24px;
  cursor: pointer;
  padding: 5px;
  border-radius: 5px;
  transition: background 0.2s;
}

.emoji-option:hover {
  background: rgba(255, 255, 255, 0.1);
}

.modal-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modal-content {
  background: var(--dark-light);
  padding: 20px;
  border-radius: 12px;
  max-width: 90%;
  max-height: 80%;
  overflow-y: auto;
  color: var(--text);
  width: 400px;
}

.modal-title {
  color: var(--primary);
  margin-top: 0;
  margin-bottom: 15px;
}

.form-section {
  margin-bottom: 20px;
}

.form-section-title {
  color: var(--primary);
  font-size: 16px;
  margin-bottom: 10px;
  padding-bottom: 5px;
  border-bottom: 1px solid #334155;
}

.tournament-details {
  line-height: 1.6;
}

.tournament-details strong {
  color: var(--primary);
}

.loading {
  text-align: center;
  padding: 20px;
  color: var(--text-secondary);
}

.wallet-section {
  margin: 15px 0;
}

.transaction-list {
  max-height: 200px;
  overflow-y: auto;
}

.transaction-item {
  padding: 10px;
  border-bottom: 1px solid #334155;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.transaction-item:last-child {
  border-bottom: none;
}

.status-pending {
  color: #f59e0b;
}

.status-approved {
  color: var(--success);
}

.status-rejected {
  color: var(--danger);
}

.registration-tabs {
  display: flex;
  margin-bottom: 15px;
  border-bottom: 1px solid #334155;
}

.tab-btn {
  padding: 10px 15px;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-weight: 500;
  cursor: pointer;
}

.tab-btn.active {
  color: var(--primary);
  border-bottom: 2px solid var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.text-small {
  font-size: 12px;
  color: var(--text-secondary);
}

.currency-badge {
  background: var(--primary);
  color: var(--dark);
  padding: 2px 8px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 12px;
}

.player-name {
  color: var(--primary);
  font-weight: 500;
}

.player-list {
  max-height: 200px;
  overflow-y: auto;
  margin-top: 10px;
}

.player-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid #334155;
}

.player-item:last-child {
  border-bottom: none;
}

.player-uid {
  font-size: 12px;
  color: var(--text-secondary);
}

.uploading {
  opacity: 0.7;
  pointer-events: none;
}

.progress-bar {
  height: 5px;
  background: #334155;
  border-radius: 10px;
  margin-top: 5px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--primary);
  width: 0%;
  transition: width 0.3s;
}

.announcement-item {
  padding: 12px;
  border-bottom: 1px solid #334155;
}

.announcement-item:last-child {
  border-bottom: none;
}

.announcement-title {
  color: var(--primary);
  font-weight: 600;
  margin-bottom: 5px;
}

.announcement-date {
  font-size: 12px;
  color: var(--text-secondary);
}

.filter-buttons {
  display: flex;
  gap: 8px;
  margin-bottom: 15px;
  overflow-x: auto;
  padding-bottom: 5px;
}

.filter-btn {
  background: var(--dark);
  color: var(--text-secondary);
  border: none;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  white-space: nowrap;
  cursor: pointer;
}

.filter-btn.active {
  background: var(--primary);
  color: var(--dark);
}

.user-search-result {
  display: flex;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid #334155;
  cursor: pointer;
}

.user-search-result:last-child {
  border-bottom: none;
}

.user-search-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  margin-right: 12px;
  border: 2px solid var(--primary);
}

.user-search-info {
  flex: 1;
}

.user-search-name {
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 4px;
}

.user-search-uid {
  font-size: 12px;
  color: var(--text-secondary);
}

.banned-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: var(--danger);
  z-index: 10;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
}

.banned-icon {
  font-size: 40px;
  margin-bottom: 10px;
}

.search-results-container {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--dark-light);
  border-radius: 0 0 12px 12px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 100;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  display: none;
}

.search-results-container.active {
  display: block;
}

.verified-badge {
  color: var(--info);
  margin-left: 5px;
}

.organizer-section {
  border-left: 3px solid var(--organizer);
  padding-left: 10px;
  margin: 20px 0;
}

.organizer-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.winner-selection {
  background: rgba(16, 185, 129, 0.1);
  border-radius: 8px;
  padding: 10px;
  margin-top: 10px;
}

.winner-list {
  max-height: 150px;
  overflow-y: auto;
  margin-top: 10px;
}

.winner-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid rgba(16, 185, 129, 0.2);
}

.winner-item:last-child {
  border-bottom: none;
}

.winner-selected {
  background: rgba(16, 185, 129, 0.2);
}

.organizer-tournament-card {
  border: 1px solid var(--organizer);
}

.organizer-tournament-card .tournament-title {
  color: var(--organizer);
}

.tournament-winner-badge {
  background: var(--organizer);
  color: white;
  padding: 4px 8px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  margin-left: 10px;
}

.admin-section {
  border-left: 3px solid var(--admin);
  padding-left: 10px;
  margin: 20px 0;
}

.admin-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.admin-table {
  width: 100%;
  border-collapse: collapse;
  margin: 15px 0;
}

.admin-table th, .admin-table td {
  padding: 10px;
  text-align: left;
  border-bottom: 1px solid #334155;
}

.admin-table th {
  color: var(--primary);
  font-weight: 600;
}

.admin-table tr:hover {
  background-color: rgba(255, 255, 255, 0.05);
}

.action-buttons {
  display: flex;
  gap: 5px;
}

.admin-filter {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.admin-filter select, .admin-filter input {
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #334155;
  background: var(--dark);
  color: var(--text);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.stat-box {
  background: var(--dark-light);
  padding: 15px;
  border-radius: 8px;
  text-align: center;
}

.stat-box i {
  font-size: 24px;
  margin-bottom: 10px;
  color: var(--primary);
}

.stat-box h3 {
  margin: 0;
  font-size: 24px;
  color: var(--primary);
}

.stat-box p {
  margin: 5px 0 0;
  color: var(--text-secondary);
  font-size: 14px;
}

.tab-container {
  margin-top: 20px;
}

.tab-header {
  display: flex;
  border-bottom: 1px solid #334155;
  margin-bottom: 20px;
}

.tab-header button {
  padding: 10px 20px;
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-weight: 500;
}

.tab-header button.active {
  color: var(--primary);
  border-bottom: 2px solid var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

.admin-activity-log {
  margin-top: 20px;
  max-height: 300px;
  overflow-y: auto;
  border: 1px solid #334155;
  border-radius: 8px;
  padding: 10px;
}

.activity-item {
  padding: 8px;
  border-bottom: 1px solid #334155;
  font-size: 14px;
}

.activity-item:last-child {
  border-bottom: none;
}

.activity-admin {
  color: var(--admin);
  font-weight: 600;
}

.activity-action {
  color: var(--primary);
}

.activity-target {
  color: var(--info);
}

.activity-time {
  color: var(--text-secondary);
  font-size: 12px;
  display: block;
}

.balance-control {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.balance-control input {
  flex: 1;
}

.notification {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 15px 20px;
  border-radius: 8px;
  background: var(--dark-light);
  color: var(--text);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 10px;
  transform: translateX(100%);
  transition: transform 0.3s ease;
}

.notification.show {
  transform: translateX(0);
}

.notification.success {
  border-left: 4px solid var(--success);
}

.notification.error {
  border-left: 4px solid var(--danger);
}

.notification.info {
  border-left: 4px solid var(--info);
}

.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: var(--primary);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<!-- Admin Login Page -->
<div id="adminLoginPage" class="container">
  <div class="card">
    <h2 class="text-center mb-4">👑 FF Kingdom Admin Panel</h2>
    
    <div class="input-group">
      <label for="adminPassword">🔒 Admin Password</label>
      <input id="adminPassword" type="password" placeholder="Enter admin password"/>
    </div>
    <button id="adminLoginBtn" class="btn btn-admin w-100"><i class="fas fa-lock"></i> Login as Admin</button>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden">
  <div class="header">
    <h1>👑 FF Kingdom Admin</h1>
    <button id="adminLogoutBtn" class="btn btn-sm btn-danger"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>

  <div class="container">
    <div class="stats-grid">
      <div class="stat-box">
        <i class="fas fa-users"></i>
        <h3 id="totalPlayers">0</h3>
        <p>Total Players</p>
      </div>
      <div class="stat-box">
        <i class="fas fa-crown"></i>
        <h3 id="totalOrganizers">0</h3>
        <p>Total Organizers</p>
      </div>
      <div class="stat-box">
        <i class="fas fa-trophy"></i>
        <h3 id="totalTournaments">0</h3>
        <p>Active Tournaments</p>
      </div>
      <div class="stat-box">
        <i class="fas fa-money-bill-wave"></i>
        <h3 id="totalRevenue">0</h3>
        <p>Total Revenue</p>
      </div>
    </div>

    <div class="tab-container">
      <div class="tab-header">
        <button class="tab-btn active" data-tab="players">Players</button>
        <button class="tab-btn" data-tab="organizers">Organizers</button>
        <button class="tab-btn" data-tab="tournaments">Tournaments</button>
        <button class="tab-btn" data-tab="deposits">Deposits</button>
        <button class="tab-btn" data-tab="withdrawals">Withdrawals</button>
        <button class="tab-btn" data-tab="announcements">Announcements</button>
        <button class="tab-btn" data-tab="activity">Activity Log</button>
      </div>

      <!-- Players Tab -->
      <div id="playersTab" class="tab-content active">
        <div class="card">
          <div class="search-container">
            <input type="text" id="playerSearchInput" class="search-input" placeholder="Search players by name or UID...">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <div class="admin-filter">
            <select id="playerFilter">
              <option value="all">All Players</option>
              <option value="verified">Verified Only</option>
              <option value="banned">Banned Only</option>
            </select>
          </div>
          
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>UID</th>
                  <th>Balance</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="playersList">
                <tr>
                  <td colspan="5" class="text-center py-3">Loading players...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Organizers Tab -->
      <div id="organizersTab" class="tab-content">
        <div class="card">
          <div class="search-container">
            <input type="text" id="organizerSearchInput" class="search-input" placeholder="Search organizers by name...">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <div class="admin-filter">
            <select id="organizerFilter">
              <option value="all">All Organizers</option>
              <option value="verified">Verified Only</option>
              <option value="unverified">Unverified Only</option>
              <option value="banned">Banned Only</option>
            </select>
          </div>
          
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Tournaments</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="organizersList">
                <tr>
                  <td colspan="5" class="text-center py-3">Loading organizers...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tournaments Tab -->
      <div id="tournamentsTab" class="tab-content">
        <div class="card">
          <div class="search-container">
            <input type="text" id="tournamentSearchInput" class="search-input" placeholder="Search tournaments by title...">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <div class="admin-filter">
            <select id="tournamentFilter">
              <option value="all">All Tournaments</option>
              <option value="active">Active Only</option>
              <option value="completed">Completed Only</option>
              <option value="upcoming">Upcoming Only</option>
            </select>
          </div>
          
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Type</th>
                  <th>Entry Fee</th>
                  <th>Players</th>
                  <th>Organizer</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tournamentsList">
                <tr>
                  <td colspan="7" class="text-center py-3">Loading tournaments...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Deposits Tab -->
      <div id="depositsTab" class="tab-content">
        <div class="card">
          <div class="admin-filter">
            <select id="depositFilter">
              <option value="all">All Deposits</option>
              <option value="pending">Pending Only</option>
              <option value="approved">Approved Only</option>
              <option value="rejected">Rejected Only</option>
            </select>
          </div>
          
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Player</th>
                  <th>Amount</th>
                  <th>Method</th>
                  <th>Transaction ID</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="depositsList">
                <tr>
                  <td colspan="7" class="text-center py-3">Loading deposits...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Withdrawals Tab -->
      <div id="withdrawalsTab" class="tab-content">
        <div class="card">
          <div class="admin-filter">
            <select id="withdrawalFilter">
              <option value="all">All Withdrawals</option>
              <option value="pending">Pending Only</option>
              <option value="approved">Approved Only</option>
              <option value="rejected">Rejected Only</option>
            </select>
          </div>
          
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Player/Organizer</th>
                  <th>Amount</th>
                  <th>Method</th>
                  <th>Account</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="withdrawalsList">
                <tr>
                  <td colspan="7" class="text-center py-3">Loading withdrawals...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Announcements Tab -->
      <div id="announcementsTab" class="tab-content">
        <div class="card">
          <div class="admin-controls">
            <button class="btn btn-success" onclick="showCreateAnnouncementModal()">
              <i class="fas fa-plus"></i> Create Announcement
            </button>
          </div>
          
          <div class="table-responsive">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Content</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="announcementsList">
                <tr>
                  <td colspan="5" class="text-center py-3">Loading announcements...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Activity Log Tab -->
      <div id="activityTab" class="tab-content">
        <div class="card">
          <h3>Admin Activity Log</h3>
          <div class="admin-activity-log" id="adminActivityLog">
            <div class="text-center py-3">Loading activity log...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modals -->
<div class="modal-backdrop" id="modalBg">
  <div class="modal-content" id="modalContent">
    <h3 class="modal-title" id="modalTitle"></h3>
    <div id="modalBody"></div>
    <div class="d-flex gap-2 mt-3">
      <button class="btn btn-success flex-fill" id="modalConfirm">Confirm</button>
      <button class="btn flex-fill" id="modalCancel">Cancel</button>
    </div>
  </div>
</div>

<!-- Tournament Edit Modal -->
<div class="modal-backdrop" id="tournamentEditModal">
  <div class="modal-content" style="width: 500px; max-width: 90%;">
    <h3 class="modal-title">Edit Tournament</h3>
    <div id="tournamentEditForm"></div>
    <div class="d-flex gap-2 mt-3">
      <button class="btn btn-success flex-fill" id="saveTournamentBtn">Save Changes</button>
      <button class="btn flex-fill" onclick="document.getElementById('tournamentEditModal').style.display = 'none'">Cancel</button>
    </div>
  </div>
</div>

<!-- Announcement Create Modal -->
<div class="modal-backdrop" id="announcementModal">
  <div class="modal-content" style="width: 500px; max-width: 90%;">
    <h3 class="modal-title" id="announcementModalTitle">Create Announcement</h3>
    <div class="input-group">
      <label for="announcementTitle">Title</label>
      <input type="text" id="announcementTitle" placeholder="Enter announcement title">
    </div>
    <div class="input-group">
      <label for="announcementContent">Content</label>
      <textarea id="announcementContent" rows="4" placeholder="Enter announcement content"></textarea>
    </div>
    <div class="input-group">
      <label for="announcementStatus">Status</label>
      <select id="announcementStatus">
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
      </select>
    </div>
    <div class="d-flex gap-2 mt-3">
      <button class="btn btn-success flex-fill" id="saveAnnouncementBtn">Save Announcement</button>
      <button class="btn flex-fill" onclick="document.getElementById('announcementModal').style.display = 'none'">Cancel</button>
    </div>
  </div>
</div>

<!-- User Balance Edit Modal -->
<div class="modal-backdrop" id="balanceModal">
  <div class="modal-content" style="width: 400px; max-width: 90%;">
    <h3 class="modal-title" id="balanceModalTitle">Adjust User Balance</h3>
    <div class="input-group">
      <label for="balanceAmount">Amount (BDT)</label>
      <input type="number" id="balanceAmount" placeholder="Enter amount">
    </div>
    <div class="input-group">
      <label for="balanceAction">Action</label>
      <select id="balanceAction">
        <option value="add">Add Balance</option>
        <option value="subtract">Subtract Balance</option>
        <option value="set">Set Balance</option>
      </select>
    </div>
    <div class="input-group">
      <label for="balanceReason">Reason</label>
      <input type="text" id="balanceReason" placeholder="Enter reason for adjustment">
    </div>
    <div class="d-flex gap-2 mt-3">
      <button class="btn btn-success flex-fill" id="saveBalanceBtn">Save Changes</button>
      <button class="btn flex-fill" onclick="document.getElementById('balanceModal').style.display = 'none'">Cancel</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyD1-qeqgWg9-3TW--XnpWQHNTP7-ROhDIs",
  authDomain: "football-manager-cf301.firebaseapp.com",
  databaseURL: "https://football-manager-cf301-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "football-manager-cf301",
  storageBucket: "football-manager-cf301.firebasestorage.app",
  messagingSenderId: "491848692016",
  appId: "1:491848692016:web:dc080692f1c5ee6c5298f5",
  measurementId: "G-FQL2QPVX6P"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const ADMIN_PASSWORD = "swampod321";
let currentAdminId = "admin_" + Date.now();
let currentUserIdForBalance = null;

// Show notification function
function showNotification(message, type = "info") {
  const notification = document.createElement("div");
  notification.className = `notification ${type}`;
  notification.innerHTML = `
    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
    <span>${message}</span>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.classList.add("show");
  }, 100);
  
  setTimeout(() => {
    notification.classList.remove("show");
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// Log admin activity
function logAdminActivity(action, target, details = "") {
  const activity = {
    admin: "Admin User",
    action,
    target,
    details,
    timestamp: Date.now()
  };
  
  db.ref("adminActivities").push(activity)
    .then(() => {
      console.log("Activity logged");
    })
    .catch(error => {
      console.error("Error logging activity:", error);
    });
}

// Modal functionality
const modalBg = document.getElementById('modalBg');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
const modalConfirm = document.getElementById('modalConfirm');
const modalCancel = document.getElementById('modalCancel');

function showModal(title, body, confirmCallback = null, confirmText = "Confirm", cancelText = "Cancel") {
  modalTitle.innerText = title;
  modalBody.innerHTML = body;
  
  if (confirmCallback) {
    modalConfirm.style.display = 'block';
    modalConfirm.innerText = confirmText;
    modalConfirm.onclick = function() {
      confirmCallback();
      modalBg.style.display = 'none';
    };
  } else {
    modalConfirm.style.display = 'none';
  }
  
  modalCancel.innerText = cancelText;
  modalCancel.onclick = function() {
    modalBg.style.display = 'none';
  };
  
  modalBg.style.display = 'flex';
}

// Tab functionality
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const tabId = this.getAttribute('data-tab');
    
    // Update active tab button
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    
    // Show corresponding tab content
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    document.getElementById(tabId + 'Tab').classList.add('active');
    
    // Load data for the tab
    switch(tabId) {
      case 'players':
        loadPlayers();
        break;
      case 'organizers':
        loadOrganizers();
        break;
      case 'tournaments':
        loadTournaments();
        break;
      case 'deposits':
        loadDeposits();
        break;
      case 'withdrawals':
        loadWithdrawals();
        break;
      case 'announcements':
        loadAnnouncements();
        break;
      case 'activity':
        loadActivityLog();
        break;
    }
  });
});

// Load players
function loadPlayers() {
  document.getElementById('playersList').innerHTML = '<tr><td colspan="5" class="text-center py-3"><div class="loading-spinner"></div> Loading players...</td></tr>';
  
  db.ref('users').once('value').then(snapshot => {
    let playersHTML = '';
    let playerCount = 0;
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const user = child.val();
        if (!user.isOrganizer) {
          playerCount++;
          const isBanned = user.isBanned || false;
          const isVerified = user.isVerified || false;
          
          playersHTML += `
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <img src="${user.profilePic || 'https://via.placeholder.com/40'}" width="40" height="40" class="rounded-circle me-2">
                  <div>
                    ${user.name || 'Unknown'} 
                    ${isVerified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                  </div>
                </div>
              </td>
              <td>${user.freeFireUID || 'N/A'}</td>
              <td>${user.coins || 0} BDT</td>
              <td>
                ${isBanned 
                  ? '<span class="status-rejected">Banned</span>' 
                  : '<span class="status-approved">Active</span>'
                }
              </td>
              <td class="action-buttons">
                ${!isBanned 
                  ? `<button class="btn btn-sm btn-danger" onclick="banUser('${child.key}', true)">Ban</button>` 
                  : `<button class="btn btn-sm btn-success" onclick="banUser('${child.key}', false)">Unban</button>`
                }
                <button class="btn btn-sm btn-info" onclick="viewUserDetails('${child.key}')">View</button>
                <button class="btn btn-sm btn-warning" onclick="showBalanceModal('${child.key}', '${user.name || 'User'}')">Balance</button>
              </td>
            </tr>
          `;
        }
      });
    }
    
    document.getElementById('playersList').innerHTML = playersHTML || '<tr><td colspan="5" class="text-center py-3">No players found</td></tr>';
    document.getElementById('totalPlayers').innerText = playerCount;
  }).catch(error => {
    console.error("Error loading players:", error);
    document.getElementById('playersList').innerHTML = '<tr><td colspan="5" class="text-center py-3">Error loading players</td></tr>';
    showNotification("Error loading players", "error");
  });
}

// Load organizers
function loadOrganizers() {
  document.getElementById('organizersList').innerHTML = '<tr><td colspan="5" class="text-center py-3"><div class="loading-spinner"></div> Loading organizers...</td></tr>';
  
  db.ref('users').once('value').then(snapshot => {
    let organizersHTML = '';
    let organizerCount = 0;
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const user = child.val();
        if (user.isOrganizer) {
          organizerCount++;
          const isBanned = user.isBanned || false;
          const isVerified = user.isVerified || false;
          
          organizersHTML += `
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <img src="${user.profilePic || 'https://via.placeholder.com/40'}" width="40" height="40" class="rounded-circle me-2">
                  <div>
                    ${user.name || 'Unknown'} 
                    ${isVerified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                  </div>
                </div>
              </td>
              <td>${user.email || 'N/A'}</td>
              <td>${user.tournamentsCreated || 0}</td>
              <td>
                ${isBanned 
                  ? '<span class="status-rejected">Banned</span>' 
                  : (isVerified ? '<span class="status-approved">Verified</span>' : '<span class="status-pending">Unverified</span>')
                }
              </td>
              <td class="action-buttons">
                ${!isVerified 
                  ? `<button class="btn btn-sm btn-success" onclick="verifyOrganizer('${child.key}', true)">Verify</button>` 
                  : `<button class="btn btn-sm btn-warning" onclick="verifyOrganizer('${child.key}', false)">Unverify</button>`
                }
                ${!isBanned 
                  ? `<button class="btn btn-sm btn-danger" onclick="banUser('${child.key}', true)">Ban</button>` 
                  : `<button class="btn btn-sm btn-success" onclick="banUser('${child.key}', false)">Unban</button>`
                }
                <button class="btn btn-sm btn-info" onclick="viewUserDetails('${child.key}')">View</button>
                <button class="btn btn-sm btn-warning" onclick="showBalanceModal('${child.key}', '${user.name || 'User'}')">Balance</button>
              </td>
            </tr>
          `;
        }
      });
    }
    
    document.getElementById('organizersList').innerHTML = organizersHTML || '<tr><td colspan="5" class="text-center py-3">No organizers found</td></tr>';
    document.getElementById('totalOrganizers').innerText = organizerCount;
  }).catch(error => {
    console.error("Error loading organizers:", error);
    document.getElementById('organizersList').innerHTML = '<tr><td colspan="5" class="text-center py-3">Error loading organizers</td></tr>';
    showNotification("Error loading organizers", "error");
  });
}

// Load tournaments
function loadTournaments() {
  document.getElementById('tournamentsList').innerHTML = '<tr><td colspan="7" class="text-center py-3"><div class="loading-spinner"></div> Loading tournaments...</td></tr>';
  
  db.ref('tournaments').once('value').then(snapshot => {
    let tournamentsHTML = '';
    let tournamentCount = 0;
    let activeTournamentCount = 0;
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const tournament = child.val();
        tournamentCount++;
        
        const status = getTournamentStatus(tournament);
        if (status === 'active') activeTournamentCount++;
        
        const statusText = status === 'active' ? 'Active' : 
                          status === 'completed' ? 'Completed' : 'Upcoming';
        const statusClass = status === 'active' ? 'status-approved' : 
                           status === 'completed' ? 'status-rejected' : 'status-pending';
        
        tournamentsHTML += `
          <tr>
            <td>${tournament.title || 'Unknown'}</td>
            <td>${tournament.type || 'Solo'}</td>
            <td>${tournament.entryFee || 0} BDT</td>
            <td>${tournament.players ? Object.keys(tournament.players).length : 0}/${tournament.maxPlayers || 0}</td>
            <td>${tournament.organizerName || 'Unknown'}</td>
            <td><span class="${statusClass}">${statusText}</span></td>
            <td class="action-buttons">
              <button class="btn btn-sm btn-info" onclick="viewTournamentDetails('${child.key}')">View</button>
              <button class="btn btn-sm btn-warning" onclick="editTournament('${child.key}')">Edit</button>
              ${status !== 'completed' 
                ? `<button class="btn btn-sm btn-success" onclick="completeTournament('${child.key}')">Complete</button>` 
                : ''
              }
            </td>
          </tr>
        `;
      });
    }
    
    document.getElementById('tournamentsList').innerHTML = tournamentsHTML || '<tr><td colspan="7" class="text-center py-3">No tournaments found</td></tr>';
    document.getElementById('totalTournaments').innerText = activeTournamentCount;
  }).catch(error => {
    console.error("Error loading tournaments:", error);
    document.getElementById('tournamentsList').innerHTML = '<tr><td colspan="7" class="text-center py-3">Error loading tournaments</td></tr>';
    showNotification("Error loading tournaments", "error");
  });
}

// Load deposits
function loadDeposits() {
  document.getElementById('depositsList').innerHTML = '<tr><td colspan="7" class="text-center py-3"><div class="loading-spinner"></div> Loading deposits...</td></tr>';
  
  // Check both possible paths for deposits
  const depositPaths = ['deposits', 'paymentRequests'];
  let depositsLoaded = 0;
  let allDeposits = [];
  
  depositPaths.forEach(path => {
    db.ref(path).orderByChild('timestamp').once('value').then(snapshot => {
      if (snapshot.exists()) {
        snapshot.forEach(child => {
          const deposit = child.val();
          deposit.id = child.key;
          deposit.path = path;
          allDeposits.push(deposit);
        });
      }
      
      depositsLoaded++;
      
      if (depositsLoaded === depositPaths.length) {
        displayDeposits(allDeposits);
      }
    }).catch(error => {
      console.error(`Error loading deposits from ${path}:`, error);
      depositsLoaded++;
      
      if (depositsLoaded === depositPaths.length) {
        displayDeposits(allDeposits);
      }
    });
  });
}

function displayDeposits(deposits) {
  let depositsHTML = '';
  
  // Sort by timestamp (newest first)
  deposits.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
  
  if (deposits.length > 0) {
    deposits.forEach(deposit => {
      const status = deposit.status || 'pending';
      const statusClass = status === 'approved' ? 'status-approved' : 
                         status === 'rejected' ? 'status-rejected' : 'status-pending';
      
      depositsHTML += `
        <tr>
          <td>${deposit.userName || deposit.name || 'Unknown'}</td>
          <td>${deposit.amount || 0} BDT</td>
          <td>${deposit.method || deposit.paymentMethod || 'Unknown'}</td>
          <td>${deposit.transactionId || deposit.trxId || 'N/A'}</td>
          <td>${formatDate(deposit.timestamp)}</td>
          <td><span class="${statusClass}">${status.charAt(0).toUpperCase() + status.slice(1)}</span></td>
          <td class="action-buttons">
            ${status === 'pending' 
              ? `
                <button class="btn btn-sm btn-success" onclick="updateDepositStatus('${deposit.id}', 'approved', '${deposit.path}')">Approve</button>
                <button class="btn btn-sm btn-danger" onclick="updateDepositStatus('${deposit.id}', 'rejected', '${deposit.path}')">Reject</button>
              ` 
              : ''
            }
            <button class="btn btn-sm btn-info" onclick="viewDepositDetails('${deposit.id}', '${deposit.path}')">View</button>
          </td>
        </tr>
      `;
    });
  }
  
  document.getElementById('depositsList').innerHTML = depositsHTML || '<tr><td colspan="7" class="text-center py-3">No deposits found</td></tr>';
}

// Load withdrawals
function loadWithdrawals() {
  document.getElementById('withdrawalsList').innerHTML = '<tr><td colspan="7" class="text-center py-3"><div class="loading-spinner"></div> Loading withdrawals...</td></tr>';
  
  // Check both possible paths for withdrawals
  const withdrawalPaths = ['withdrawals', 'withdrawalRequests'];
  let withdrawalsLoaded = 0;
  let allWithdrawals = [];
  
  withdrawalPaths.forEach(path => {
    db.ref(path).orderByChild('timestamp').once('value').then(snapshot => {
      if (snapshot.exists()) {
        snapshot.forEach(child => {
          const withdrawal = child.val();
          withdrawal.id = child.key;
          withdrawal.path = path;
          allWithdrawals.push(withdrawal);
        });
      }
      
      withdrawalsLoaded++;
      
      if (withdrawalsLoaded === withdrawalPaths.length) {
        displayWithdrawals(allWithdrawals);
      }
    }).catch(error => {
      console.error(`Error loading withdrawals from ${path}:`, error);
      withdrawalsLoaded++;
      
      if (withdrawalsLoaded === withdrawalPaths.length) {
        displayWithdrawals(allWithdrawals);
      }
    });
  });
}

function displayWithdrawals(withdrawals) {
  let withdrawalsHTML = '';
  
  // Sort by timestamp (newest first)
  withdrawals.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
  
  if (withdrawals.length > 0) {
    withdrawals.forEach(withdrawal => {
      const status = withdrawal.status || 'pending';
      const statusClass = status === 'approved' ? 'status-approved' : 
                         status === 'rejected' ? 'status-rejected' : 'status-pending';
      
      withdrawalsHTML += `
        <tr>
          <td>${withdrawal.userName || withdrawal.name || 'Unknown'}</td>
          <td>${withdrawal.amount || 0} BDT</td>
          <td>${withdrawal.method || withdrawal.paymentMethod || 'Unknown'}</td>
          <td>${withdrawal.accountInfo || withdrawal.accountNumber || 'N/A'}</td>
          <td>${formatDate(withdrawal.timestamp)}</td>
          <td><span class="${statusClass}">${status.charAt(0).toUpperCase() + status.slice(1)}</span></td>
          <td class="action-buttons">
            ${status === 'pending' 
              ? `
                <button class="btn btn-sm btn-success" onclick="updateWithdrawalStatus('${withdrawal.id}', 'approved', '${withdrawal.path}')">Approve</button>
                <button class="btn btn-sm btn-danger" onclick="updateWithdrawalStatus('${withdrawal.id}', 'rejected', '${withdrawal.path}')">Reject</button>
              ` 
              : ''
            }
            <button class="btn btn-sm btn-info" onclick="viewWithdrawalDetails('${withdrawal.id}', '${withdrawal.path}')">View</button>
          </td>
        </tr>
      `;
    });
  }
  
  document.getElementById('withdrawalsList').innerHTML = withdrawalsHTML || '<tr><td colspan="7" class="text-center py-3">No withdrawals found</td></tr>';
}

// Load announcements
function loadAnnouncements() {
  document.getElementById('announcementsList').innerHTML = '<tr><td colspan="5" class="text-center py-3"><div class="loading-spinner"></div> Loading announcements...</td></tr>';
  
  db.ref('announcements').orderByChild('timestamp').once('value').then(snapshot => {
    let announcementsHTML = '';
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const announcement = child.val();
        const status = announcement.status || 'active';
        const statusClass = status === 'active' ? 'status-approved' : 'status-rejected';
        
        announcementsHTML += `
          <tr>
            <td>${announcement.title || 'Untitled'}</td>
            <td>${(announcement.content || '').substring(0, 50)}${(announcement.content || '').length > 50 ? '...' : ''}</td>
            <td>${formatDate(announcement.timestamp)}</td>
            <td><span class="${statusClass}">${status.charAt(0).toUpperCase() + status.slice(1)}</span></td>
            <td class="action-buttons">
              <button class="btn btn-sm btn-info" onclick="viewAnnouncementDetails('${child.key}')">View</button>
              <button class="btn btn-sm btn-warning" onclick="editAnnouncement('${child.key}')">Edit</button>
              <button class="btn btn-sm btn-danger" onclick="deleteAnnouncement('${child.key}')">Delete</button>
            </td>
          </tr>
        `;
      });
    }
    
    document.getElementById('announcementsList').innerHTML = announcementsHTML || '<tr><td colspan="5" class="text-center py-3">No announcements found</td></tr>';
  }).catch(error => {
    console.error("Error loading announcements:", error);
    document.getElementById('announcementsList').innerHTML = '<tr><td colspan="5" class="text-center py-3">Error loading announcements</td></tr>';
    showNotification("Error loading announcements", "error");
  });
}

// Load activity log
function loadActivityLog() {
  const activityLog = document.getElementById('adminActivityLog');
  activityLog.innerHTML = '<div class="text-center py-3"><div class="loading-spinner"></div> Loading activity log...</div>';
  
  db.ref('adminActivities').orderByChild('timestamp').limitToLast(50).once('value').then(snapshot => {
    let activitiesHTML = '';
    
    if (snapshot.exists()) {
      snapshot.forEach(child => {
        const activity = child.val();
        
        activitiesHTML += `
          <div class="activity-item">
            <span class="activity-admin">${activity.admin}</span>
            <span class="activity-action">${activity.action}</span>
            <span class="activity-target">${activity.target}</span>
            ${activity.details ? `<div>${activity.details}</div>` : ''}
            <span class="activity-time">${formatDate(activity.timestamp)}</span>
          </div>
        `;
      });
    }
    
    activityLog.innerHTML = activitiesHTML || '<div class="text-center py-3">No activities found</div>';
  }).catch(error => {
    console.error("Error loading activity log:", error);
    activityLog.innerHTML = '<div class="text-center py-3">Error loading activity log</div>';
    showNotification("Error loading activity log", "error");
  });
}

// Helper functions
function getTournamentStatus(tournament) {
  const now = Date.now();
  const startTime = tournament.startTime || 0;
  const endTime = tournament.endTime || 0;
  
  if (now > endTime) return 'completed';
  if (now > startTime && now < endTime) return 'active';
  return 'upcoming';
}

function formatDate(timestamp) {
  if (!timestamp) return 'N/A';
  const date = new Date(timestamp);
  return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
}

// User management functions
function banUser(userId, ban) {
  const action = ban ? 'ban' : 'unban';
  const reason = prompt(`Enter reason for ${action}:`);
  
  if (reason !== null) {
    db.ref(`users/${userId}/isBanned`).set(ban)
      .then(() => {
        showNotification(`User ${ban ? 'banned' : 'unbanned'} successfully`, "success");
        logAdminActivity(`${ban ? 'Banned' : 'Unbanned'} user`, userId, `Reason: ${reason}`);
        loadPlayers();
        loadOrganizers();
      })
      .catch(error => {
        console.error(`Error ${action}ing user:`, error);
        showNotification(`Failed to ${action} user`, "error");
      });
  }
}

function verifyOrganizer(userId, verify) {
  db.ref(`users/${userId}/isVerified`).set(verify)
    .then(() => {
      showNotification(`Organizer ${verify ? 'verified' : 'unverified'} successfully`, "success");
        logAdminActivity(`${verify ? 'Verified' : 'Unverified'} organizer`, userId);
        loadOrganizers();
      })
      .catch(error => {
        console.error(`Error ${verify ? 'verifying' : 'unverifying'} organizer:`, error);
        showNotification(`Failed to ${verify ? 'verify' : 'unverify'} organizer`, "error");
      });
}

function viewUserDetails(userId) {
  db.ref(`users/${userId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const user = snapshot.val();
      
      const userDetails = `
        <div class="profile-header">
          <img src="${user.profilePic || 'https://via.placeholder.com/80'}" class="profile-pic">
          <div class="profile-info">
            <h3 class="profile-name">${user.name || 'Unknown'}</h3>
            <p>${user.email || 'No email'}</p>
            <p>UID: ${user.freeFireUID || 'N/A'}</p>
          </div>
        </div>
        
        <div class="profile-stats">
          <div class="stat-card">
            <div class="stat-value">${user.coins || 0}</div>
            <div class="stat-label">Coins</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${user.diamonds || 0}</div>
            <div class="stat-label">Diamonds</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${user.tournamentsJoined || 0}</div>
            <div class="stat-label">Tournaments</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${user.wins || 0}</div>
            <div class="stat-label">Wins</div>
          </div>
        </div>
        
        <div class="form-section">
          <div class="form-section-title">Account Details</div>
          <p><strong>Status:</strong> ${user.isBanned ? '<span class="status-rejected">Banned</span>' : '<span class="status-approved">Active</span>'}</p>
          ${user.isOrganizer ? `<p><strong>Organizer Status:</strong> ${user.isVerified ? '<span class="status-approved">Verified</span>' : '<span class="status-pending">Unverified</span>'}</p>` : ''}
          <p><strong>Registered:</strong> ${formatDate(user.createdAt)}</p>
        </div>
      `;
      
      showModal('User Details', userDetails, null, 'Close');
    }
  });
}

// Show balance adjustment modal
function showBalanceModal(userId, userName) {
  currentUserIdForBalance = userId;
  document.getElementById('balanceModalTitle').innerText = `Adjust Balance for ${userName}`;
  document.getElementById('balanceAmount').value = '';
  document.getElementById('balanceAction').value = 'add';
  document.getElementById('balanceReason').value = '';
  
  document.getElementById('balanceModal').style.display = 'flex';
  
  document.getElementById('saveBalanceBtn').onclick = function() {
    const amount = parseInt(document.getElementById('balanceAmount').value) || 0;
    const action = document.getElementById('balanceAction').value;
    const reason = document.getElementById('balanceReason').value;
    
    if (amount <= 0) {
      showNotification('Please enter a valid amount', 'error');
      return;
    }
    
    if (!reason) {
      showNotification('Please enter a reason for this adjustment', 'error');
      return;
    }
    
    adjustUserBalance(userId, amount, action, reason);
  };
}

// Adjust user balance
function adjustUserBalance(userId, amount, action, reason) {
  db.ref(`users/${userId}/coins`).once('value').then(snapshot => {
    const currentBalance = snapshot.val() || 0;
    let newBalance = currentBalance;
    
    if (action === 'add') {
      newBalance = currentBalance + amount;
    } else if (action === 'subtract') {
      newBalance = Math.max(0, currentBalance - amount);
    } else if (action === 'set') {
      newBalance = amount;
    }
    
    db.ref(`users/${userId}/coins`).set(newBalance)
      .then(() => {
        // Log the transaction
        const transaction = {
          userId: userId,
          type: 'admin_adjustment',
          amount: action === 'add' ? amount : -amount,
          previousBalance: currentBalance,
          newBalance: newBalance,
          reason: reason,
          adminId: currentAdminId,
          timestamp: Date.now()
        };
        
        db.ref('adminTransactions').push(transaction)
          .then(() => {
            showNotification(`Balance updated successfully. New balance: ${newBalance} BDT`, 'success');
            logAdminActivity('Adjusted user balance', userId, `Amount: ${amount} BDT, Action: ${action}, Reason: ${reason}`);
            document.getElementById('balanceModal').style.display = 'none';
            loadPlayers();
            loadOrganizers();
          });
      })
      .catch(error => {
        console.error('Error updating balance:', error);
        showNotification('Failed to update balance', 'error');
      });
  });
}

// Tournament management functions
function viewTournamentDetails(tournamentId) {
  db.ref(`tournaments/${tournamentId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const tournament = snapshot.val();
      const status = getTournamentStatus(tournament);
      
      let playersList = '';
      if (tournament.players) {
        Object.keys(tournament.players).forEach(playerId => {
          const player = tournament.players[playerId];
          playersList += `<li>${player.name || 'Unknown'} (${player.freeFireUID || 'N/A'})</li>`;
        });
      }
      
      const details = `
        <div class="tournament-details">
          <h4>${tournament.title || 'Unknown Tournament'}</h4>
          <p><strong>Type:</strong> ${tournament.type || 'Solo'}</p>
          <p><strong>Entry Fee:</strong> ${tournament.entryFee || 0} BDT</p>
          <p><strong>Prize Pool:</strong> ${tournament.prizePool || 0} BDT</p>
          <p><strong>Players:</strong> ${tournament.players ? Object.keys(tournament.players).length : 0}/${tournament.maxPlayers || 0}</p>
          <p><strong>Status:</strong> ${status.charAt(0).toUpperCase() + status.slice(1)}</p>
          <p><strong>Start Time:</strong> ${formatDate(tournament.startTime)}</p>
          <p><strong>End Time:</strong> ${formatDate(tournament.endTime)}</p>
          <p><strong>Organizer:</strong> ${tournament.organizerName || 'Unknown'}</p>
          
          ${playersList ? `
            <div class="form-section">
              <div class="form-section-title">Registered Players</div>
              <ul>${playersList}</ul>
            </div>
          ` : ''}
          
          ${tournament.winner ? `
            <div class="winner-selection">
              <h5>Winner: ${tournament.winner.name || 'Unknown'}</h5>
              <p>Prize: ${tournament.winner.prize || 0} BDT</p>
            </div>
          ` : ''}
        </div>
      `;
      
      showModal('Tournament Details', details, null, 'Close');
    }
  });
}

function editTournament(tournamentId) {
  db.ref(`tournaments/${tournamentId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const tournament = snapshot.val();
      
      const editForm = `
        <div class="input-group">
          <label for="editTitle">Title</label>
          <input type="text" id="editTitle" value="${tournament.title || ''}">
        </div>
        
        <div class="input-group">
          <label for="editDescription">Description</label>
          <textarea id="editDescription" rows="3">${tournament.description || ''}</textarea>
        </div>
        
        <div class="input-group">
          <label for="editEntryFee">Entry Fee (BDT)</label>
          <input type="number" id="editEntryFee" value="${tournament.entryFee || 0}">
        </div>
        
        <div class="input-group">
          <label for="editPrizePool">Prize Pool (BDT)</label>
          <input type="number" id="editPrizePool" value="${tournament.prizePool || 0}">
        </div>
        
        <div class="input-group">
          <label for="editMaxPlayers">Max Players</label>
          <input type="number" id="editMaxPlayers" value="${tournament.maxPlayers || 0}">
        </div>
        
        <div class="input-group">
          <label for="editStartTime">Start Time</label>
          <input type="datetime-local" id="editStartTime" value="${formatDateForInput(tournament.startTime)}">
        </div>
        
        <div class="input-group">
          <label for="editEndTime">End Time</label>
          <input type="datetime-local" id="editEndTime" value="${formatDateForInput(tournament.endTime)}">
        </div>
      `;
      
      document.getElementById('tournamentEditForm').innerHTML = editForm;
      document.getElementById('tournamentEditModal').style.display = 'flex';
      
      document.getElementById('saveTournamentBtn').onclick = function() {
        const updates = {
          title: document.getElementById('editTitle').value,
          description: document.getElementById('editDescription').value,
          entryFee: parseInt(document.getElementById('editEntryFee').value) || 0,
          prizePool: parseInt(document.getElementById('editPrizePool').value) || 0,
          maxPlayers: parseInt(document.getElementById('editMaxPlayers').value) || 0,
          startTime: new Date(document.getElementById('editStartTime').value).getTime(),
          endTime: new Date(document.getElementById('editEndTime').value).getTime()
        };
        
        db.ref(`tournaments/${tournamentId}`).update(updates)
          .then(() => {
            showNotification('Tournament updated successfully', 'success');
            logAdminActivity('Edited tournament', tournamentId);
            document.getElementById('tournamentEditModal').style.display = 'none';
            loadTournaments();
          })
          .catch(error => {
            console.error('Error updating tournament:', error);
            showNotification('Failed to update tournament', 'error');
          });
      };
    }
  });
}

function completeTournament(tournamentId) {
  db.ref(`tournaments/${tournamentId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const tournament = snapshot.val();
      
      let winnerOptions = '';
      if (tournament.players) {
        Object.keys(tournament.players).forEach(playerId => {
          const player = tournament.players[playerId];
          winnerOptions += `<option value="${playerId}">${player.name || 'Unknown Player'}</option>`;
        });
      }
      
      const completeForm = `
        <div class="input-group">
          <label for="winnerSelect">Select Winner</label>
          <select id="winnerSelect">
            ${winnerOptions || '<option value="">No players registered</option>'}
          </select>
        </div>
        
        <div class="input-group">
          <label for="prizeAmount">Prize Amount (BDT)</label>
          <input type="number" id="prizeAmount" value="${tournament.prizePool || 0}">
        </div>
      `;
      
      showModal('Complete Tournament', completeForm, function() {
        const winnerId = document.getElementById('winnerSelect').value;
        const prizeAmount = parseInt(document.getElementById('prizeAmount').value) || 0;
        
        if (!winnerId) {
          showNotification('Please select a winner', 'error');
          return;
        }
        
        // Get winner details
        const winner = tournament.players[winnerId];
        
        // Update tournament with winner
        db.ref(`tournaments/${tournamentId}/winner`).set({
          id: winnerId,
          name: winner.name,
          prize: prizeAmount
        }).then(() => {
          // Update winner's balance
          db.ref(`users/${winnerId}/coins`).transaction(currentCoins => {
            return (currentCoins || 0) + prizeAmount;
          }).then(() => {
            showNotification('Tournament completed successfully. Prize distributed to winner.', 'success');
            logAdminActivity('Completed tournament', tournamentId, `Winner: ${winner.name}, Prize: ${prizeAmount} BDT`);
            loadTournaments();
          });
        }).catch(error => {
          console.error('Error completing tournament:', error);
          showNotification('Failed to complete tournament', 'error');
        });
      }, 'Complete');
    }
  });
}

// Deposit/Withdrawal management functions
function updateDepositStatus(depositId, status, path) {
  db.ref(`${path}/${depositId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const deposit = snapshot.val();
      
      db.ref(`${path}/${depositId}/status`).set(status)
        .then(() => {
          if (status === 'approved') {
            // Add coins to user's account
            db.ref(`users/${deposit.userId}/coins`).transaction(currentCoins => {
              return (currentCoins || 0) + (deposit.amount || 0);
            }).then(() => {
              showNotification('Deposit approved and coins added to user account', 'success');
              logAdminActivity('Approved deposit', depositId, `Amount: ${deposit.amount} BDT, User: ${deposit.userName}`);
              loadDeposits();
            });
          } else {
            showNotification(`Deposit ${status}`, 'success');
            logAdminActivity(`${status === 'rejected' ? 'Rejected' : 'Updated'} deposit`, depositId);
            loadDeposits();
          }
        })
        .catch(error => {
          console.error(`Error ${status}ing deposit:`, error);
          showNotification(`Failed to ${status} deposit`, 'error');
        });
    }
  });
}

function updateWithdrawalStatus(withdrawalId, status, path = 'withdrawals') {
  db.ref(`${path}/${withdrawalId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const withdrawal = snapshot.val();
      
      db.ref(`${path}/${withdrawalId}/status`).set(status)
        .then(() => {
          if (status === 'rejected') {
            // Return coins to user's account if rejected
            db.ref(`users/${withdrawal.userId}/coins`).transaction(currentCoins => {
              return (currentCoins || 0) + (withdrawal.amount || 0);
            }).then(() => {
              showNotification('Withdrawal rejected and coins returned to user account', 'success');
              logAdminActivity('Rejected withdrawal', withdrawalId, `Amount: ${withdrawal.amount} BDT returned to user`);
              loadWithdrawals();
            });
          } else {
            showNotification(`Withdrawal ${status}`, 'success');
            logAdminActivity(`${status === 'approved' ? 'Approved' : 'Updated'} withdrawal`, withdrawalId);
            loadWithdrawals();
          }
        })
        .catch(error => {
          console.error(`Error ${status}ing withdrawal:`, error);
          showNotification(`Failed to ${status} withdrawal`, 'error');
        });
    }
  });
}

function viewDepositDetails(depositId, path) {
  db.ref(`${path}/${depositId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const deposit = snapshot.val();
      
      const details = `
        <div class="tournament-details">
          <p><strong>User:</strong> ${deposit.userName || deposit.name || 'Unknown'}</p>
          <p><strong>Amount:</strong> ${deposit.amount || 0} BDT</p>
          <p><strong>Method:</strong> ${deposit.method || deposit.paymentMethod || 'Unknown'}</p>
          <p><strong>Transaction ID:</strong> ${deposit.transactionId || deposit.trxId || 'N/A'}</p>
          <p><strong>Status:</strong> ${deposit.status || 'pending'}</p>
          <p><strong>Date:</strong> ${formatDate(deposit.timestamp)}</p>
          ${deposit.screenshot ? `<p><strong>Screenshot:</strong> <a href="${deposit.screenshot}" target="_blank">View</a></p>` : ''}
        </div>
      `;
      
      showModal('Deposit Details', details, null, 'Close');
    }
  });
}

function viewWithdrawalDetails(withdrawalId, path = 'withdrawals') {
  db.ref(`${path}/${withdrawalId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const withdrawal = snapshot.val();
      
      const details = `
        <div class="tournament-details">
          <p><strong>User:</strong> ${withdrawal.userName || withdrawal.name || 'Unknown'}</p>
          <p><strong>Amount:</strong> ${withdrawal.amount || 0} BDT</p>
          <p><strong>Method:</strong> ${withdrawal.method || withdrawal.paymentMethod || 'Unknown'}</p>
          <p><strong>Account Info:</strong> ${withdrawal.accountInfo || withdrawal.accountNumber || 'N/A'}</p>
          <p><strong>Status:</strong> ${withdrawal.status || 'pending'}</p>
          <p><strong>Date:</strong> ${formatDate(withdrawal.timestamp)}</p>
        </div>
      `;
      
      showModal('Withdrawal Details', details, null, 'Close');
    }
  });
}

// Announcement management functions
function showCreateAnnouncementModal() {
  document.getElementById('announcementModalTitle').innerText = 'Create Announcement';
  document.getElementById('announcementTitle').value = '';
  document.getElementById('announcementContent').value = '';
  document.getElementById('announcementStatus').value = 'active';
  
  document.getElementById('announcementModal').style.display = 'flex';
  
  document.getElementById('saveAnnouncementBtn').onclick = function() {
    const title = document.getElementById('announcementTitle').value;
    const content = document.getElementById('announcementContent').value;
    const status = document.getElementById('announcementStatus').value;
    
    if (!title || !content) {
      showNotification('Please fill in all fields', 'error');
      return;
    }
    
    const newAnnouncement = {
      title: title,
      content: content,
      status: status,
      timestamp: Date.now()
    };
    
    db.ref('announcements').push(newAnnouncement)
      .then(() => {
        showNotification('Announcement created successfully', 'success');
        logAdminActivity('Created announcement', title);
        document.getElementById('announcementModal').style.display = 'none';
        loadAnnouncements();
      })
      .catch(error => {
        console.error('Error creating announcement:', error);
        showNotification('Failed to create announcement', 'error');
      });
  };
}

function editAnnouncement(announcementId) {
  db.ref(`announcements/${announcementId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const announcement = snapshot.val();
      
      document.getElementById('announcementModalTitle').innerText = 'Edit Announcement';
      document.getElementById('announcementTitle').value = announcement.title || '';
      document.getElementById('announcementContent').value = announcement.content || '';
      document.getElementById('announcementStatus').value = announcement.status || 'active';
      
      document.getElementById('announcementModal').style.display = 'flex';
      
      document.getElementById('saveAnnouncementBtn').onclick = function() {
        const title = document.getElementById('announcementTitle').value;
        const content = document.getElementById('announcementContent').value;
        const status = document.getElementById('announcementStatus').value;
        
        if (!title || !content) {
          showNotification('Please fill in all fields', 'error');
          return;
        }
        
        const updates = {
          title: title,
          content: content,
          status: status
        };
        
        db.ref(`announcements/${announcementId}`).update(updates)
          .then(() => {
            showNotification('Announcement updated successfully', 'success');
            logAdminActivity('Edited announcement', title);
            document.getElementById('announcementModal').style.display = 'none';
            loadAnnouncements();
          })
          .catch(error => {
            console.error('Error updating announcement:', error);
            showNotification('Failed to update announcement', 'error');
          });
      };
    }
  });
}

function viewAnnouncementDetails(announcementId) {
  db.ref(`announcements/${announcementId}`).once('value').then(snapshot => {
    if (snapshot.exists()) {
      const announcement = snapshot.val();
      
      const details = `
        <div class="tournament-details">
          <h4>${announcement.title || 'Untitled'}</h4>
          <p>${announcement.content || 'No content'}</p>
          <p><strong>Status:</strong> ${announcement.status || 'active'}</p>
          <p><strong>Date:</strong> ${formatDate(announcement.timestamp)}</p>
        </div>
      `;
      
      showModal('Announcement Details', details, null, 'Close');
    }
  });
}

function deleteAnnouncement(announcementId) {
  if (confirm('Are you sure you want to delete this announcement?')) {
    db.ref(`announcements/${announcementId}`).once('value').then(snapshot => {
      const announcement = snapshot.val();
      
      db.ref(`announcements/${announcementId}`).remove()
        .then(() => {
          showNotification('Announcement deleted successfully', 'success');
          logAdminActivity('Deleted announcement', announcement.title || announcementId);
          loadAnnouncements();
        })
        .catch(error => {
          console.error('Error deleting announcement:', error);
          showNotification('Failed to delete announcement', 'error');
        });
    });
  }
}

// Helper function for datetime input
function formatDateForInput(timestamp) {
  if (!timestamp) return '';
  const date = new Date(timestamp);
  return date.toISOString().slice(0, 16);
}

// Admin login
document.getElementById('adminLoginBtn').addEventListener('click', function() {
  const password = document.getElementById('adminPassword').value;
  
  if (password === ADMIN_PASSWORD) {
    document.getElementById('adminLoginPage').classList.add('hidden');
    document.getElementById('adminPanel').classList.remove('hidden');
    
    // Log admin login
    logAdminActivity('Logged in', 'Admin Panel');
    
    // Load initial data
    loadPlayers();
  } else {
    showNotification('Incorrect admin password', 'error');
  }
});

// Admin logout
document.getElementById('adminLogoutBtn').addEventListener('click', function() {
  // Log admin logout
  logAdminActivity('Logged out', 'Admin Panel');
  
  document.getElementById('adminLoginPage').classList.remove('hidden');
  document.getElementById('adminPanel').classList.add('hidden');
  document.getElementById('adminPassword').value = '';
});

// Initialize with players tab
loadPlayers();
</script>
</body>
</html>
